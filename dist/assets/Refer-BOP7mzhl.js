import{c as M,r as d,u as O,b as Q,s as c,j as e,m as k,B as N}from"./index-BnrvrOIj.js";import{L as F,I as L}from"./label-hNtTl7_J.js";import{C as u,b as h,c as p,a as g}from"./card-Dpt68COV.js";import{S as b}from"./share-2-GvUJsJBN.js";import{U as z}from"./users-B3xqg6tN.js";import{T as G}from"./trophy-DC13u2nG.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J=M("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]),re=()=>{const[f,T]=d.useState(""),[v,U]=d.useState([]),[I,A]=d.useState(!0),[m,w]=d.useState(""),[j,C]=d.useState(!1),[Y,q]=d.useState(""),[R,_]=d.useState([]),{user:s}=O(),{toast:a}=Q();d.useEffect(()=>{s&&(E(),B())},[s]);const E=async()=>{try{const{data:r,error:t}=await c.from("registrations").select(`
          referral_code,
          id,
          referred_by,
          referrer:registrations!referred_by(referral_code)
        `).eq("user_id",s.id).single();if(t&&t.code!=="PGRST116")throw t;if(r){C(!0),T(r.referral_code),r.referrer&&r.referrer.referral_code&&(q(r.referrer.referral_code),w(r.referrer.referral_code));const{data:i,error:n}=await c.from("registrations").select("fullName, email, created_at").eq("referred_by",r.id);if(n)throw n;U(i||[])}else C(!1)}catch(r){console.error("Error fetching referral data:",r),a({title:"Error",description:"Failed to load referral data.",variant:"destructive"})}finally{A(!1)}},B=async()=>{try{const{data:r,error:t}=await c.from("registrations").select("referred_by").not("referred_by","is",null);if(t)throw t;const i=[...new Set(r.map(l=>l.referred_by))];if(i.length===0){_([]);return}const{data:n,error:S}=await c.from("registrations").select("id, fullName, email").in("id",i);if(S)throw S;const y={};n.forEach(l=>{y[l.id]={fullName:l.fullName,email:l.email}});const x={};r.forEach(l=>{const o=l.referred_by;x[o]||(x[o]={id:o,count:0,fullName:y[o]?.fullName||"Unknown",email:y[o]?.email||"Unknown"}),x[o].count++});const H=Object.values(x).sort((l,o)=>o.count-l.count).slice(0,5);_(H)}catch(r){console.error("Error fetching leaderboard:",r)}},D=()=>{navigator.clipboard.writeText(f),a({title:"Copied!",description:"Referral code copied to clipboard."})},P=()=>{const r=`${window.location.origin}/register?ref=${f}`;navigator.share?navigator.share({title:"Join Qiskit Fall Fest 2025",text:"Use my referral code to register!",url:r}):(navigator.clipboard.writeText(r),a({title:"Link Copied!",description:"Referral link copied to clipboard."}))},$=async()=>{if(!m.trim()){a({title:"Error",description:"Please enter a referral code.",variant:"destructive"});return}if(m.trim()===f){a({title:"Invalid Code",description:"You cannot use your own referral code.",variant:"destructive"});return}try{let r=null;const{data:t}=await c.from("registrations").select("id, user_id").eq("referral_code",m.trim()).single();if(t){if(t.user_id===s.id){a({title:"Invalid Code",description:"You cannot use your own referral code.",variant:"destructive"});return}r=t.id}else{a({title:"Invalid Code",description:"The referral code you entered is invalid.",variant:"destructive"});return}if(j){const{error:i}=await c.from("registrations").update({referred_by:r}).eq("user_id",s.id);if(i)throw i}else{const i=btoa(s.id).substring(0,8),{error:n}=await c.from("registrations").insert([{user_id:s.id,fullName:s.user_metadata?.full_name||s.email,email:s.email,referral_code:i,referred_by:r}]);if(n)throw n}a({title:"Referral Applied!",description:"Your referral code has been applied successfully."}),E()}catch(r){console.error("Error applying referral code:",r),a({title:"Error",description:"Failed to apply referral code. Please try again.",variant:"destructive"})}};return I?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4"}),e.jsx("p",{children:"Loading..."})]})}):e.jsx(k.div,{initial:{opacity:0},animate:{opacity:1},className:"min-h-screen bg-background py-20",children:e.jsx("div",{className:"container mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs(k.div,{initial:{opacity:0,y:30},animate:{opacity:1,y:0},transition:{duration:.8},className:"max-w-4xl mx-auto",children:[e.jsxs("div",{className:"text-center mb-12",children:[e.jsx("h1",{className:"text-4xl lg:text-5xl font-bold font-poppins mb-4",children:"Refer & Earn"}),e.jsx("p",{className:"text-lg text-muted-foreground",children:"Share your referral code and invite friends to join Qiskit Fall Fest 2025"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 mb-12",children:[e.jsxs(u,{className:"glass-card border border-white/10",children:[e.jsx(h,{children:e.jsxs(p,{className:"flex items-center",children:[e.jsx(b,{className:"h-5 w-5 mr-2 text-primary"}),"Friend's Referral Code"]})}),e.jsxs(g,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(F,{htmlFor:"friendReferralCode",children:"Referral Code"}),e.jsx(L,{id:"friendReferralCode",type:"text",value:m,onChange:r=>w(r.target.value),placeholder:"Enter your friend's referral code",className:"font-mono"})]}),e.jsx(N,{onClick:$,className:"w-full",children:"Apply/Update Referral Code"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:Y?"Update your friend's referral code if needed.":"Enter a referral code from a friend to earn rewards!"})]})]}),e.jsxs(u,{className:"glass-card border border-white/10",children:[e.jsx(h,{children:e.jsxs(p,{className:"flex items-center",children:[e.jsx(b,{className:"h-5 w-5 mr-2 text-primary"}),"Your Referral Code"]})}),e.jsx(g,{className:"space-y-4",children:j?e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx(F,{children:"Referral Code"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(L,{value:f,readOnly:!0,className:"font-mono"}),e.jsx(N,{onClick:D,variant:"outline",children:e.jsx(J,{className:"h-4 w-4"})})]})]}),e.jsxs(N,{onClick:P,className:"w-full",children:[e.jsx(b,{className:"h-4 w-4 mr-2"}),"Share Referral Link"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Share this code with friends during registration to earn rewards!"})]}):e.jsx("p",{className:"text-muted-foreground",children:"Apply a friend's referral code first to get your own referral code."})})]}),e.jsxs(u,{className:"glass-card border border-white/10",children:[e.jsx(h,{children:e.jsxs(p,{className:"flex items-center",children:[e.jsx(z,{className:"h-5 w-5 mr-2 text-primary"}),"People You've Referred"]})}),e.jsx(g,{children:j?v.length===0?e.jsx("p",{className:"text-muted-foreground",children:"No referrals yet. Start sharing!"}):e.jsx("div",{className:"space-y-3",children:v.map((r,t)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted/50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:r.fullName}),e.jsx("p",{className:"text-sm text-muted-foreground",children:r.email})]}),e.jsx("span",{className:"text-sm text-muted-foreground",children:new Date(r.created_at).toLocaleDateString()})]},t))}):e.jsx("p",{className:"text-muted-foreground",children:"Apply a friend's referral code to start referring others."})})]})]}),e.jsx("div",{className:"max-w-2xl mx-auto",children:e.jsxs(u,{className:"glass-card border border-white/10",children:[e.jsx(h,{children:e.jsxs(p,{className:"flex items-center justify-center",children:[e.jsx(G,{className:"h-6 w-6 mr-3 text-primary"}),"Top Referrers Leaderboard"]})}),e.jsx(g,{children:R.length===0?e.jsx("p",{className:"text-muted-foreground text-center",children:"No referrals yet. Be the first!"}):e.jsx("div",{className:"space-y-4",children:R.map((r,t)=>e.jsxs("div",{className:"flex items-center justify-between p-4 bg-muted/50 rounded-lg hover:bg-muted/70 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("span",{className:`text-2xl font-bold min-w-[40px] ${t===0?"text-yellow-500":t===1?"text-gray-400":t===2?"text-amber-600":"text-muted-foreground"}`,children:["#",t+1]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-lg",children:r.fullName}),e.jsx("p",{className:"text-sm text-muted-foreground",children:console.log(r)})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("span",{className:"text-lg font-bold text-primary",children:r.count}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["referral",r.count!==1?"s":""]})]})]},r.id))})})]})})]})})})};export{re as default};
